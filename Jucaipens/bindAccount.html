<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<script src="js/mui.min.js"></script>
		<link href="css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="css/style.css" />
		<script type="text/javascript" charset="UTF-8">
			mui.init();
			var auths;
			//获取服务列表
			document.addEventListener("plusready",function(){
					plus.oauth.getServices(function(service){
						auths=service;
					}, 
					function(e){
					},false); 
				})
			mui.plusReady(function(){
				var bindQQ=document.getElementById("bind-qq");
				var bindWeixin=document.getElementById("bind-weixin");
				var bindSina=document.getElementById("bind-sina");
				var qqState=document.getElementById("qq-state");
				var weixinState=document.getElementById("weixin-state");
				var sinaState=document.getElementById("sina-state");
				var bindList="http://121.40.227.121:8080/AccumulateWealth/jucaipen/otherAccountList";
				var bindAccount="http://121.40.227.121:8080/AccumulateWealth/jucaipen/updateOtherAccount";
				var uId=plus.storage.getItem("userId");
				var isQQBind;
				var isWeixinBind;
				var isSinaBind;
				
				
				if(uId<=0){
					return ;
				}
				findBindState();
				
				
				//获取账号绑定状态
				
				function findBindState(){
					mui.ajax(bindList,{
						data:{
							userId:uId
						},
						type:"get",
						dataType:"json",
						timeout:10000,
						success: function(data){
							if(data.ret_code==0){
								if(data.qqId.length>0){
									qqState.innerText='已绑定';
									bindQQ.innerText='解除绑定';
									isQQBind=true;
								}else{
									qqState.innerText='未绑定';
									bindQQ.innerText='快速绑定';
									isQQBind=false;
								}
								if(data.weixinId.length>0){
									weixinState.innerText='已绑定';
									bindWeixin.innerText='解除绑定';
									isWeixinBind=true;
								}else{
									weixinState.innerText='未绑定';
									bindWeixin.innerText='快速绑定';
									isWeixinBind=false;
								}
								if(data.sinaId.length>0){
									sinaState.innerText='已绑定';
									bindSina.innerText='解除绑定';
									isSinaBind=true;
								}else{
									sinaState.innerText='未绑定';
									bindSina.innerText='快速绑定';
									isSinaBind=false;
								}
								
							}
						},
						error: function(e){
						}
					})
				}
				
				
				
				//绑定账号  0
				bindQQ.addEventListener("tap",function(){
					var id=login(0);
					var type=0;
					bindAccounts(type,id);

					if(isQQBind){
						//解除绑定QQ
					}else{
						//绑定QQ
					}
				})
				
				//新浪   1
				bindSina.addEventListener("tap",function(){
					var id=login(1);
					var type=2;
					if(isSinaBind){
						//解除新浪绑定
						bindAccounts(type,id);
					}else{
						//绑定新浪
					}
				})
				
				
				//微信   2
				bindWeixin.addEventListener("tap",function(){
					var id=login(2);
					var type=1;
					
					if(isWeixinBind){
						//解除微信绑定
						bindAccounts(type,id);
					}else{
						//绑定微信
					}
				})
				
				
				
				
				
				function bindAccounts(t,id){
					mui.ajax(bindAccount,{
						data:{
							userId:uId,
							accountType:t,
							accountId:id
						},
						type:'get',
						dataType:"json",
						timeout:10000,
						success: function(data){
							console.log(JSON.stringify(data));
						},
						error: function(e){
							
						}
					})
					
				}
				
				
				
				
				//获取账号openid
				
				function login(index){
					var openId;
					var a=auths[index];
					if(!a.authResult){
						a.login(function(s){
						  openId=s.target.authResult.openid;
						},function(e){
							
						})
					}else{
						//已经登录
						openId=a.authResult.openid;
					}
					console.log(openId);
					return openId;
				}
				
				
				
			})
		</script>
		<style type="text/css">
			.mui-content div {
				margin-top: 50px;
			}
			
			.mui-pull-right {
				color: #0033FF;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav" style="background: #CF2D28;">
	<div id="pageTop1_show_login_link" class="denglu mui-action-back"> <a><i><img src="image/into_back.png" /></i><em></em></a></div>
			<h1 class="mui-title" style="color: white;">账号绑定</h1>
		</header>
		<div class="mui-content">
			
			<div class="item1">
				<img src="image/qq.png" style="width: 50px; height: 50px;float: left;margin-left: 20px;" />
				<label style="line-height: 50px;margin-left: 30%;" id="qq-state">未绑定</label>
				<label class="mui-pull-right" style="line-height: 50px;margin-right: 20px;" id="bind-qq">快速绑定</label>

			</div>
			<div class="item2">
				<img src="image/weixin.png" style="width: 50px; height: 50px;float: left;margin-left: 20px;" />
				<label style="line-height: 50px;margin-left: 30%;" id="weixin-state">未绑定</label>
				<label class="mui-pull-right" style="line-height: 50px;margin-right: 20px;" id="bind-weixin">快速绑定</label>
			</div>
			<div class="item3">
				<img src="image/logo_sinaweibo.png" style="width: 50px; height: 50px;float: left;margin-left: 20px;" />
				<label style="line-height: 50px;margin-left: 30%;" id="sina-state">未绑定</label>
				<label class="mui-pull-right" style="line-height: 50px;margin-right: 20px;" id="bind-sina">快速绑定</label>
			</div>

		</div>

	</body>

</html>