<!DOCTYPE html>
<html>
	<!--
    	作者：185601452@qq.com
    	时间：2016-02-04
    	描述：直播列表
    -->

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<link href="css/style.css" rel="stylesheet" type="text/css" />

		<script src="js/mui.min.js"></script>
		<script type="text/javascript" src="js/stringUtil.js"></script>
		<link href="css/mui.min.css" rel="stylesheet" />
		<script type="text/javascript" charset="UTF-8">
			mui.init({
				swipeBack: true //启用右滑关闭功能
			});
			mui.plusReady(function() {
				var videoList = "http://121.40.227.121:8080/AccumulateWealth/accumulate/teachVideo";
				var video = document.getElementById("data-live");
				var pageTop1_show_login_link = document.getElementById("pageTop1_show_login_link");
				var load = document.getElementById("load");
				//获取直播列表信息
				load.style.display = 'block';
				var liveInfo = "";
				mui.ajax(videoList, {
						dataType: "json",
						type: "get",
						timeout: 10000,
						success: function(data) {
							load.style.display = 'none';
							var reginDate = plus.storage.getItem("reginDate");
							var buyProductId = plus.storage.getItem("buyProductId");
							for (var i = 0; i < data.length; i++) {
								var liveUrl = data[i].liveUrl;
								var roomFace = data[i].RoomFace;
								var UserLevel = data[i].UserLevel;
								if (liveUrl != null) {
									liveInfo = liveInfo + "<li face=" + roomFace + " style='float: left;width: 46%;'id=" + data[i].id + " isVisit=" + data[i].IsStopYouke + " visitDay=" + data[i].ShiTingDay + " visitLeal=" + data[i].UserLevel + ">" + "<span><a ><img src=" + roomFace + "  /><h3>" + data[i].roomName + "</h3></a></span></li>";
								}
							}
							video.innerHTML = liveInfo;
							mui("#data-live").on("tap", "li", function() {
								var lId = this.getAttribute("id");
								var face = this.getAttribute('face');
								// 是否免费试听  0   是     1   否
								var visit = this.getAttribute("isVisit");
								//试听天数
								var visitDay = this.getAttribute("visitDay");
								//试听用户等级
								var visitLeal = this.getAttribute("visitLeal");
								var uId = plus.storage.getItem("userId");
								if (visit == 0) { 
									//免费
									intoLiveRoom(lId, face);
									return;
								}
								if (uId <= 0) {
									//跳转到登录
									plus.nativeUI.confirm("您还没有登录，此房间不允许游客登录!", function(e) {
										intoLogin();
									}, "", ['确定']);
								} else {
									var isServer = plus.storage.getItem("isServer");
									var isManager = plus.storage.getItem("isManager");
									var buyProductId = plus.storage.getItem("buyProductId");
									if (visit == 1) {
										if (isServer == 1 || isManager == 1 || UserLevel == visitLeal) {
											//管理员客服,已购买用户可以进入
											intoLiveRoom(lId, face);
											return;
										}
										plus.nativeUI.alert("您没有此房间的权限，请联系管理员！", function(e) {}, "", "确定");
									}
								}
							});
						},
						error: function(e) {}
					})
					//进入直播室
				function intoLiveRoom(liveId, roomFace) {
					mui.openWindow({
						url: "liveRoom.html",
						id: "liveRoom",
						extras: {
							liveId: liveId,
							face: roomFace
						},
						waiting: {
							autoShow: false
						}
					})
				}
				//进入登录界面
				function intoLogin() {
					mui.openWindow({
						url: "login.html",
						id: "login",
						waiting: {
							autoShow: false
						}
					})
				}
				//进入会员中心
				function intoCenter() {
					mui.openWindow({
						url: "vipcenter.html",
						id: "vipcenter",
						waiting: {
							autoShow: false
						}
					})
				}
				//进入登录界面
				pageTop1_show_login_link.addEventListener("tap", function() {
					var uId = plus.storage.getItem("userId");
					if (uId <= 0) {
						intoLogin();
					} else {
						intoCenter();
					}
				})
			})
		</script>
	</head>

	<body>
		<!--头部-->
		<header class="header">
			<div class="head">
				<div id="pageTop1_show_login_link" class="denglu"> <a><i><img src="image/unlogin.png" /></i><em></em></a></div>
				<div class="logo">
					<a><img src="image/jucai.png" /></a>
				</div>

			</div>
		</header>
		<div style="margin: 50px 10px 0 10px;">
			<div class="zhibohuigu_mian">
				<ul style="list-style: none;" id="data-live">
				</ul>
			</div>

		</div>

		<div style="text-align: center;margin-top: 80%;display: none;" id="load">
			<img src="image/loading-0.gif" />
		</div>

		<footer class="footer">
			<div class="foot">
				<div class="footcenter">
					<ul style="height: 60px;">
						<li><a href="index.html"><span><img src="image/indexnormal.png" style="width: 50px;height: 50px;" /></span></a></li>
						<li><a href="trhreeBoard.html"><span><img src="image/licainorma.png" style="width: 50px;height: 50px;"/></span></a></li>
						<li><a><span><img src="image/livepress.png" style="width: 50px;height: 50px;"/></span></a></li>
						<li><a href="attention.html"><span><img src="image/fincenormal.png" style="width: 50px;height: 50px;"/></span></a></li>
						<li><a href="famousDish.html"><span><img src="image/classnormal.png" style="width: 50px;height: 50px;"/></span></a></li>
					</ul>
				</div>
			</div>
		</footer>

	</body>

</html>